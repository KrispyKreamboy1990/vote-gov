{{ $translation := ( index $.Site.Data.translations $.Site.Params.language ) }}

<div class="grid-container page-inner mail-steps">
  <h1>
    {{ replace $translation.register.heading "%state_name%" ( title .Title ) }}
  </h1>
  <p class="usa-intro">
    {{ replace $translation.register.by_mail.body "%state_name%" ( title .Title ) }}
  </p>
  <!-- Steps BEGIN -->
  <div class="usa-graphic-list">
    <div class="grid-row">
      <div class="grid-col-4">
        <img src="{{ .Site.BaseURL }}/assets/img/step-1.png">
        <h4 class="usa-graphic-list__heading">
          {{ $translation.register.by_mail.step_one_label }}
        </h4>
        <p>
          {{ $translation.register.by_mail.step_one }}
        </p>
      </div>
      <div class="grid-col-4">
        <img src="{{ .Site.BaseURL }}/assets/img/step-2.png">
        <h4 class="usa-graphic-list__heading">
          {{ $translation.register.by_mail.step_two_label }}
        </h4>
        <p>
          {{ $translation.register.by_mail.step_two }}
        </p>
      </div>
      <div class="grid-col-4">
        <img src="{{ .Site.BaseURL }}/assets/img/step-3.png">
        <h4 class="usa-graphic-list__heading">
          {{ $translation.register.by_mail.step_three_label }}
        </h4>
        <p>
          {{ $translation.register.by_mail.step_three }}
        </p>
      </div>
    </div>
  </div>
  {{ partial "dates.html" . }}
  <!-- Steps END -->
</div>

<!-- Download form BEGIN -->
<div class="grid-container page-inner mail-download">
  {{ range $key, $form := $.Site.Data.registration_forms }}
    {{ if eq $key $.Site.Params.language }}
    <a id="documentDownload" class="usa-button" href="{{ $form.file_path }}" target="_blank">
      {{ $translation.register.by_mail.download }}
    </a>
    {{ end }}
  {{ end }}
  <label class="usa-label">{{ $translation.register.by_mail.download_others }}</label>
  <ul class=".usa-list.usa-list--unstyled  mail-download-list">
    {{ range $key, $form := $.Site.Data.registration_forms }}
      {{ if ne $key $.Site.Params.language }}
        <li>
          <a href="{{ $form.file_path }}" target="_blank">{{ $form.language }}</a>
        </li>
      {{ end }}
    {{ end }}
  </ul>

  
  <!-- Download form END -->

  <!-- Email form BEGIN -->
  <div id="email">
    <hr><form class="usa-form">
    <label class="usa-label" for="input-type-text">Enter your email to send the form (PDF) to yourself or someone else:</label>
    <input class="usa-input" id="input-type-text" name="input-type-text" type="text">
     <div class="g-recaptcha" data-sitekey="6LdMpLUUAAAAABA1trW4myMfF3ijM8zsDpU2USmZ" data-callback='clicked'
      style="transform:scale(1.06);-webkit-transform:scale(1.06);transform-origin:0 0;-webkit-transform-origin:0 0;"></div>
    <input class="usa-button" onclick="clicked(event)" id="js-user-submit" type="submit" value="Email the form (PDF)">
    </input>
    </form><br>
       <!-- Recaptcha Not Provided alert  -->
    <div class="usa-alert usa-alert--error" style="display: none;" id="recap">
    <div class="usa-alert__body">
      <p class="usa-alert__text">please verify you are not a Robot</p>
    </div>
    </div>
      <!-- API Not sending Email alert  -->
    <div class="usa-alert usa-alert--error" style="display: none;" id="apiError">
    <div class="usa-alert__body">
      <p class="usa-alert__text">Not able to Send Emails, Try Again</p>
    </div>
    </div>

    <!-- Success alert  -->
    <div class="usa-alert usa-alert--success" style="display: none;" id="valid">
    <div class="usa-alert__body">
      <p class="usa-alert__text">Form sent to email.</p>
    </div>
    </div>
    <!-- Failure alert -->
    <div class="usa-alert usa-alert--error" role="alert" style="display: none;" id="invalid">
      <div class="usa-alert__body">
      <p class="usa-alert__text">Please enter a valid email address.</p>
    </div>
    </div>
  </div>
   <script src="https://www.google.com/recaptcha/api.js " ></script>
    
  <script>
  function clicked(ev)
  {

      ev.preventDefault();

      var re = /^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i;
      var email = document.getElementById('input-type-text').value;

      if(!re.test(email)) {
        document.getElementById('invalid').style.display = 'block';
        document.getElementById('valid').style.display = 'none';
        document.getElementById('apiError').style.display = 'none';
        return false;

      }
      if(grecaptcha.getResponse().length == 0) { 
        document.getElementById('recap').style.display = 'block';
        document.getElementById('invalid').style.display = 'none';
        document.getElementById('apiError').style.display = 'none';
        document.getElementById('valid').style.display = 'none';
        return false;
      }
        //post to APi

      var xhr = new XMLHttpRequest();
      var url = "https://cojk706yue.execute-api.us-east-1.amazonaws.com/prod/gsaApi?email="+email+"&recaPtcha="+response+"&document="+documentDownload;
      xhr.open("POST", url, true);
      xhr.setRequestHeader("Content-Type", "application/json");  
      xhr.send();


      xhr.onreadystatechange = function() {    
        if (this.readyState == 4 && this.status == 200) {
           document.getElementById('valid').style.display = 'block';
           document.getElementById('invalid').style.display = 'none';
           document.getElementById('apiError').style.display = 'none';
        }
        else {
           document.getElementById('apiError').style.display = 'block';
           document.getElementById('invalid').style.display = 'none';
           document.getElementById('recap').style.display = 'none';
           document.getElementById('valid').style.display = 'none';
           document.getElementById("input-type-text").value = "";
          grecaptcha.reset();

        }
          
      }
     
  }

  document.getElementById('input-type-text').onsubmit = function(ev) {
     ev.preventDefault();
     clicked(ev);
  };

  </script>

</div>
<!-- Email form END -->
