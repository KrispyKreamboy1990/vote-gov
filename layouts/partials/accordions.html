{{ $translation := ( index $.Site.Data.translations $.Site.Params.language ) }}

<div class="accordions">
  <h2>{{$translation.accordion.header}}</h2>
  <button onclick="accordion()" id="b" class="usa-button usa-button--outline">Open All</button>
  <div class="usa-accordion usa-accordion--bordered" aria-multiselectable="true">
    <div id="deadlines"></div>
      <script type="text/javascript">
        var stateObj = {{ index .Site.Data.elections.election_dates (.Params.title | lower ) }}
        var stateDates = stateObj.important_dates
        for (var i = 0; i < stateDates.length; i++) {
          var eventName = stateDates[i].date_type;
          var eventDate = stateDates[i].date;
          //1. Create header
          var li = document.createElement('h3');
          {{ if eq $.Site.Params.language "english" }}
            li.innerHTML = eventName;
          {{ else }}
            li.innerHTML = stateDates[i].spanish_date_type;
          {{ end }}
          li.classList.add('usa-accordion__heading');
          li.classList.add('usa-accordion__button');
          li.setAttribute('aria-expanded', 'false');
          //Name aria control attribute based on order in for loop
          li.setAttribute('aria-controls', 'b-a' + i);
          document.getElementById('deadlines').appendChild(li);
          //2. Create dropdown
          var date = document.createElement('div');
          date.innerHTML = {{$translation.accordion.date}} + eventDate;
          date.classList.add('usa-accordion__content');
          date.classList.add('usa-prose');
          date.setAttribute('id', 'b-a' + i);
          document.getElementById('deadlines').appendChild(date);
      }

      function open() {
        return (document.getElementById('b').innerHTML == 'Close All'? false : true);
      }

      function accordion() {
        var accordions = document.querySelectorAll('h3');
        event.preventDefault();
        for (var i = 0; i < accordions.length; i++) {
          var header = accordions[i];
          var dropdown = document.getElementById('b-a' + i);
          if(open()) {
            header.setAttribute('aria-expanded', 'true');
            dropdown.removeAttribute('hidden');
          } else {
            header.setAttribute('aria-expanded', 'false');
            dropdown.setAttribute('hidden', 'true');
          }
        }
        document.getElementById('b').innerHTML = (open()? 'Close All': 'Open All');
      }

    </script>
  </div>
  </div>
</div>
